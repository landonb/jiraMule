#!/usr/bin/env ruby

require 'rubygems'
require 'commander/import'
require 'jiraTool'

program :version, '0.0.1'
program :description, 'me'
global_option '--verbose', 'Be chatty'
global_option '-n', '--dry', "Don't run actions that make changes"
global_option '--config' # TODO

require 'jiraTool/status'
require 'jiraTool/testReady'
# difference between testReady and release is two things:
# 1. testReady also assigns
# 2. release also transitions
#
# So, merge all that into one command and have the parts be --options

command :query do |c|
  c.syntax = 'jira query [options] query'
  c.summary = 'Get the keys from a jira query'
  c.description = ''
  c.example 'description', 'command example'
  c.action do |args, options|
    # Do something or c.when_called Jira::Commands::Release
		jira = JiraUtils.new(args, options)
		q = args.join(' ')
		issues = jira.getIssues(q)
		keys = issues.map {|item| item['key'] + ' ' + item.access('fields.summary')}
		keys.each {|k| puts k}
  end
end

command :release do |c|
  c.syntax = 'jira release [options]'
  c.summary = ''
  c.description = ''
  c.example 'description', 'command example'
  c.option '--some-switch', 'Some switch that does something'
  c.action do |args, options|
    # Do something or c.when_called Jira::Commands::Release
  end
end

#  vim: set sw=2 ts=2 :
